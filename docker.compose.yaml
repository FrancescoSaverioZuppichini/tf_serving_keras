version: '3'

services:
  detector-app:
    networks:
      - detector
    container_name: detector-app
    build:
      context: ./detector-app/
      dockerfile: Dockerfile
    ports: 
      - '80:80'
    depends_on:
      - detector-api
      - cors-anywhere

  detector-api:
    networks:
      - detector
    container_name: detector-api
    build:
      context: ./detector-api
      dockerfile: Dockerfile
    ports:
      - '8001:8001'
    environment:
      - NODE_CONFIG={
          "tf_serving":{
            "host":"detector_model_serving"
          },
          "mock":{
            "tf_serving_client":false
          }
        }
      - NODE_ENV=docker
    depends_on:
      - detector_model_serving

  detector_model_serving:
    networks:
      - detector
    container_name: detector_model_serving
    build:
      context: ./model_serving
      dockerfile: Dockerfile
    ports:
      - '9000:9000'
      - '8501:8501'

networks:
  detector:
    driver: bridge
